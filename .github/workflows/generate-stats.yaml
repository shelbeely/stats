name: GitHub Profile Stats

on:
  schedule:
    # Run everyday at 12:00 UTC to collect fresh stats
    - cron: "0 12 * * *"
  workflow_dispatch:  # Allow manual trigger for testing

permissions:
  # Give the default GITHUB_TOKEN write permission to commit and push the
  # added or changed files to the repository.
  contents: write

jobs:
  Collect-GitHub-Stats:
    runs-on: ubuntu-latest
    concurrency:
      group: stats-concurrency
      cancel-in-progress: true
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Collect GitHub profile statistics
        uses: LukasParke/stats-action@1b17782114cf6e0cbbf66aafd3a542bc9e1d803e # v0.0.6+
        env:
          # Personal Access Token with required scopes:
          # - read:user (for user profile data)
          # - repo (for repository stats, views, and PRIVATE REPOS access)
          # This enables collection of:
          # - All-time contribution history (including years before 2025)
          # - Private repository statistics and contributions
          # - Repository view counts
          # - Complete contribution calendar data
          GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install Python dependencies
        run: pip install requests

      - name: Fetch private repository information
        env:
          GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
        run: python scripts/fetch-private-repo-info.py

      - name: Commit and push updated stats
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: update github stats [skip ci]"
          file_pattern: "github-user-stats.json README.md"
